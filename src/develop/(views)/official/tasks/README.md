# Tasks 模块文档

## 概述

Tasks 模块是任务管理系统的核心组成部分，基于 TanStack Router 路由系统构建，提供完整的任务管理功能，包括任务创建、编辑、状态跟踪、优先级管理等。该模块采用了抽屉式设计和现代化的用户界面，提供流畅的任务管理体验。

## 目录结构

```
tasks/
├── index.tsx                    # 主页面组件 - 任务管理界面入口
├── components/                  # 组件目录 - 包含所有任务相关组件
│   ├── data-table-bulk-actions.tsx    # 批量操作组件 - 多选任务时的批量操作
│   ├── data-table-row-actions.tsx     # 行操作组件 - 单个任务的操作按钮
│   ├── tasks-columns.tsx               # 表格列定义 - 数据表格的列配置
│   ├── tasks-dialogs.tsx               # 对话框集合 - 所有对话框的统一管理
│   ├── tasks-import-dialog.tsx         # 导入对话框 - 批量导入任务功能
│   ├── tasks-multi-delete-dialog.tsx    # 批量删除对话框 - 多任务删除确认
│   ├── tasks-mutate-drawer.tsx         # 任务编辑抽屉 - 创建/编辑任务的主要界面
│   ├── tasks-primary-buttons.tsx       # 主要操作按钮 - 页面顶部操作按钮
│   ├── tasks-provider.tsx              # 状态提供者 - 任务状态管理上下文
│   └── tasks-table.tsx                 # 任务表格 - 主要的数据展示表格
└── data/                       # 数据目录 - 包含数据模型和示例数据
    ├── data.tsx              # 配置数据 - 任务状态、标签、优先级配置
    ├── schema.ts             # 数据模型 - Zod验证schema和类型定义
    └── tasks.ts              # 任务数据源 - 模拟任务数据数组
```

## 文件详细说明

### 主页面

#### `index.tsx`

**作用**: 任务管理模块的主入口页面
**功能**:

- 渲染完整的任务管理界面布局
- 集成全局组件（搜索、主题切换、配置抽屉、用户下拉菜单）
- 组织页面结构（标题、描述、操作按钮、数据表格）
- 使用 TasksProvider 提供全局状态管理
- 提供任务管理的整体框架

### 组件文件 (`components/`)

#### `tasks-provider.tsx`

**作用**: 任务模块的状态管理提供者
**功能**:

- 提供全局任务状态管理（创建、更新、删除、导入）
- 管理当前操作的任务对象（currentRow）
- 控制各种对话框的打开/关闭状态
- 提供 useTasks Hook 供子组件使用
- 集中管理任务相关的操作状态

#### `tasks-table.tsx`

**作用**: 任务数据表格组件
**功能**:

- 展示任务列表数据，包含标题、状态、优先级、标签等
- 实现搜索过滤功能
- 支持排序和分页
- 集成行级和批量操作功能
- 响应式表格设计，适配不同屏幕尺寸
- 提供丰富的任务状态可视化展示

#### `tasks-columns.tsx`

**作用**: 数据表格列定义组件
**功能**:

- 定义表格各列的显示格式和渲染逻辑
- 配置任务状态的可视化图标和颜色
- 设置优先级的图形化展示（箭头图标）
- 实现标签的分类显示
- 集成用户头像和分配信息显示
- 提供列的自定义渲染和格式化

#### `tasks-mutate-drawer.tsx`

**作用**: 任务创建/编辑抽屉组件
**功能**:

- 提供完整的任务信息表单（标题、状态、标签、优先级）
- 使用 React Hook Form 和 Zod 进行表单验证
- 支持创建新任务和编辑现有任务
- 抽屉式设计，提供更好的用户体验
- 集成 SelectDropdown 组件用于选择字段
- 实现表单数据的提交和处理

#### `tasks-primary-buttons.tsx`

**作用**: 页面顶部主要操作按钮
**功能**:

- 提供"添加任务"按钮，触发任务创建抽屉
- 提供"导入任务"按钮，用于批量导入功能
- 可能包含其他全局操作按钮（如导出、批量操作等）
- 响应式按钮布局，适配移动端和桌面端

#### `data-table-row-actions.tsx`

**作用**: 单个任务行操作组件
**功能**:

- 提供编辑任务功能（触发编辑抽屉）
- 提供删除任务功能（触发删除确认）
- 可能包含其他行级操作（如复制、更改状态等）
- 下拉菜单形式的操作按钮，节省界面空间
- 根据任务状态提供不同的操作选项

#### `data-table-bulk-actions.tsx`

**作用**: 批量操作组件
**功能**:

- 在多选任务时显示批量操作选项
- 提供批量删除功能
- 可能包含批量状态更改、批量标签分配等
- 动态显示选中任务数量
- 提供批量操作的确认机制

#### `tasks-dialogs.tsx`

**作用**: 所有对话框的统一管理组件
**功能**:

- 集中管理任务相关的所有弹窗对话框
- 控制删除对话框和导入对话框的显示/隐藏状态
- 提供对话框间的事件通信和数据传递
- 统一的对话框渲染逻辑和状态管理
- 确保对话框之间的互斥性和一致性

#### `tasks-multi-delete-dialog.tsx`

**作用**: 批量删除确认对话框
**功能**:

- 显示批量删除确认提示，防止误操作
- 展示被删除任务的数量和简要信息
- 提供确认和取消操作按钮
- 处理批量删除后的状态更新和界面刷新
- 集成删除前的最后确认机制

#### `tasks-import-dialog.tsx`

**作用**: 任务导入对话框
**功能**:

- 提供批量导入任务的界面
- 支持 CSV、JSON 等格式的文件上传
- 提供导入预览和数据映射功能
- 处理导入过程中的错误和验证
- 显示导入进度和结果统计
- 提供导入模板下载功能

### 数据文件 (`data/`)

#### `schema.ts`

**作用**: 任务数据模型定义和类型验证
**功能**:

- 定义任务数据结构的 Zod schema
- 确保数据类型安全和运行时验证
- 导出 TypeScript 类型供其他组件使用
- 提供任务基础字段的验证规则

**任务字段**:

- `id`: 任务唯一标识符
- `title`: 任务标题
- `status`: 任务状态
- `label`: 任务标签
- `priority`: 任务优先级

#### `data.tsx`

**作用**: 任务配置数据定义
**功能**:

- 定义任务标签分类（Bug、Feature、Documentation）
- 配置任务状态（Backlog、Todo、In Progress、Done、Canceled）
- 定义任务优先级（Low、Medium、High、Critical）
- 为每个配置项提供对应的图标组件
- 统一管理任务的分类配置

**状态配置**:

- `Backlog`: 待办事项（HelpCircle 图标）
- `Todo`: 待处理（Circle 图标）
- `In Progress`: 进行中（Timer 图标）
- `Done`: 已完成（CheckCircle 图标）
- `Canceled`: 已取消（CircleOff 图标）

**优先级配置**:

- `Low`: 低优先级（ArrowDown 图标）
- `Medium`: 中等优先级（ArrowRight 图标）
- `High`: 高优先级（ArrowUp 图标）
- `Critical`: 紧急优先级（AlertCircle 图标）

#### `tasks.ts`

**作用**: 示例任务数据源
**功能**:

- 使用 @faker-js/faker 生成 100 个模拟任务
- 提供各种状态、标签和优先级的示例数据
- 包含完整的任务信息（标题、描述、截止日期、分配人员等）
- 使用固定种子确保数据一致性
- 用于开发、测试和演示环境

**任务属性**:

- 基础信息：ID、标题、状态、标签、优先级
- 时间信息：创建时间、更新时间、截止日期
- 人员信息：任务分配人员
- 详细信息：任务描述

## 技术栈

- **React 19**: 使用最新的 React 特性和 Hooks
- **TypeScript**: 严格的类型检查和类型安全
- **Zod**: 数据验证和类型推断
- **React Hook Form**: 高性能的表单处理
- **TanStack Router**: 路由管理和状态同步
- **Shadcn UI**: 现代化的 UI 组件库
- **Lucide React**: 图标组件库
- **TailwindCSS**: 原子化 CSS 框架
- **@faker-js/faker**: 模拟数据生成

## 数据流

1. **数据加载**: `tasks.ts` → `index.tsx` → `TasksProvider` → `TasksTable`
2. **任务操作**: `TasksTable` → `TasksMutateDrawer` → `TasksProvider` → 数据更新
3. **状态管理**: `TasksProvider` 统一管理所有任务相关状态
4. **类型验证**: `schema.ts` 提供数据结构验证和类型安全
5. **UI 配置**: `data.tsx` 提供状态、标签、优先级的可视化配置

## 核心特性

### 抽屉式设计

- 使用 `Sheet` 组件实现侧边抽屉
- 提供更好的用户体验，不会遮挡主要内容
- 支持关闭按钮和外部点击关闭

### 批量操作

- 支持多选任务进行批量删除
- 可扩展其他批量操作（状态更改、标签分配等）
- 提供批量操作的确认机制

### 数据可视化

- 使用图标直观显示任务状态和优先级
- 不同颜色区分不同类型的任务
- 响应式设计适配不同设备

### 表单验证

- 使用 Zod schema 进行严格的数据验证
- 实时表单验证和错误提示
- 确保数据的完整性和一致性

## 扩展指南

### 添加新的任务字段

1. 在 `schema.ts` 中更新 `taskSchema`
2. 在 `tasks-columns.tsx` 中添加新的列定义
3. 在 `tasks-mutate-drawer.tsx` 中添加表单字段
4. 更新 `tasks.ts` 中的示例数据

### 添加新的任务状态

1. 在 `data.tsx` 中添加新的状态配置和图标
2. 更新 `tasks.ts` 中的状态数据
3. 在相关组件中处理新状态的显示逻辑

### 添加新的批量操作

1. 在 `data-table-bulk-actions.tsx` 中添加新的操作按钮
2. 在 `TasksProvider` 中实现相应的处理逻辑
3. 添加对应的确认对话框（如需要）

### 添加新的导入格式

1. 在 `tasks-import-dialog.tsx` 中添加新的格式支持
2. 实现对应的解析和验证逻辑
3. 更新导入模板和示例文件

## 注意事项

- 所有组件都遵循严格的 TypeScript 类型检查
- 使用 Zod 进行运行时数据验证，确保数据安全
- 组件采用单一职责原则，每个组件功能明确
- 遵循 Shadcn UI 的设计规范和可访问性标准
- 支持深色模式和主题切换
- 响应式设计，适配各种屏幕尺寸
- 使用 faker 库生成一致的测试数据
- 表单验证和错误处理遵循最佳实践
- 抽屉式设计提供更好的用户体验
- 支持键盘导航和可访问性功能
